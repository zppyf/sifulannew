<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="css/public.css">
    <link rel="stylesheet" href="css/style.css">
    <style type="text/css">
        main{padding-top:80px;}
        main table img{width: 60px;margin:0 auto;}
        main table em{display: block;width: 100px;line-height: 30px;text-align: center;background: deepskyblue;border-radius: 6px;margin: 0 auto;margin-top: 10px;font-style: normal;cursor: pointer;color: #fff;}
        main table input[type="number"]{width:50px}
    </style>
</head>
<body>
        <header>
            <div class="margin clear">
                <div class="header-l">
                    <span>欢迎来到丝芙兰</span> 
                    <div class="header-lc">
                        <a href="denglu.html">请登录</a>
                        <span>|</span>
                        <a href="zhuce.html">免费注册</a>
                    </div>
                </div>
                <div class="header-r">
                    <img src="images/s1.png"><a href="">我的丝芙兰</a>
                    <img src="images/s2.png"><a href="">会员俱乐部</a>
                    <a href="">手机丝芙兰</a>
                    <a href="">美力事业</a>
                    <a href="">帮助中心</a>
                </div>
            </div>
        </header>
        <nav>
            <div class="margin clear">
                <div class="nav-t clear">
                    <a href="index.html" class="logo"><img src="https://ssl1.sephorastatic.cn/soa/pc/images/sep_top_Logo.png"></a>
                </div>
                
            </div>
        </nav>
        <main>
            <table border="1" cellspacing="0" width="1000" align="center">
                <thead>
                    <tr>
                        <th></th>
                        <th width="100">商品图片</th>
                        <th>名字</th>
                        <th>价格</th>
                        <th width="120">数量</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="tbody">
                    <!--<tr>
                        <td><input type="checkbox" name="" id="" value="" /></td>
                        <td><img src=""/></td>
                        <td>名字</td>
                        <td>价格</td>
                        <td>1</td>
                        <td><em data-index="">删除</em></td>
                    </tr>-->
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="2"><input type="checkbox" name="" id="" value="" />全部选中</td>
                        <td align="right">总价：</td>
                        <td>0</td>
                        <td>总数量：0</td>
                        <td><em>全部删除</em></td>
                    </tr>
                </tfoot>
            </table>
        </main>
        <div id="info">
            <div class="margin">
                <div class="info-t">
                    <div class="box">
                        <!-- <img src="https://ssl1.sephorastatic.cn/soa/pc/images/footer_ico_sprite.png"> -->
                        <i class="a1"></i>
                        <span>顺丰EMS速达</span>
                    </div>
                    <div class="box">
                        <i class="a2"></i>
                        <span>顺丰EMS速达</span>
                    </div>
                    <div class="box">
                        <i class="a3"></i>
                        <span>顺丰EMS速达</span>
                    </div>
                    <div class="box">
                        <i class="a4"></i>
                        <span>顺丰EMS速达</span>
                    </div>
                    <div class="box">
                        <i class="a5"></i>
                        <span>顺丰EMS速达</span>
                    </div>
                </div>
                <div class="info-b clear">
                    <dl>
                        <dt>购物流程</dt>
                        <dd><a href="">大宗采购/团购</a></dd>
                        <dd><a href="">丝芙兰预付卡章程</a></dd>
                    </dl>
                    <dl>
                        <dt>支付/配送</dt>
                        <dd><a href="">货到付款</a></dd>
                        <dd><a href="">在线支付</a></dd>
                        <dd><a href="">配送时间</a></dd>
                    </dl>
                    <dl>
                        <dt>售后服务</dt>
                        <dd><a href="">退换货规定</a></dd>
                        <dd><a href="">退货及退款说明</a></dd>
                    </dl>
                    <dl>
                        <dt>关于丝芙兰</dt>
                        <dd><a href="">公司介绍</a></dd>
                        <dd><a href="">联系我们</a></dd>
                    </dl>
                    <dl>
                            <dt>网上订购咨询热线 : 400 670 0055</dt>
                    </dl>
                </div>
            </div>
        </div>
        <footer>
            <p>
                <img src="https://ssl1.sephorastatic.cn/soa/pc/images/footer-redords-icon.png">
                <span>沪公网安备 683258785798439号</span>
                <span>ICP备案序号：沪ICP备2184021号</span>
                <span>食品经营许可证</span>
                <span>网站使用条款</span>
                <span>严正声明</span>
            </p>
            <p>本网站隶属于丝芙兰（上海）化妆品销售有限公司（企业法人营业执照）</p>
        </footer>
</body>
<script src="libs/ajax.3.1.js" type="text/javascript" charset="utf-8"></script>
<script src="libs/cookie.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" charset="utf-8">
 class Car{
       constructor(options){
           this.tbody = options.tbody;
           this.url = options.url;

           this.load()
           this.addEvent();
           console.log(this.url)
           console.log(getCookie("goods"))
        }
        load(){
            var that=this;
            ajax({
                url:this.url,
                success:function(res){
                    that.res=JSON.parse(res);
                    
                     console.log(that.res)
            

                    that.getCookie();
                }
            })
        }
        getCookie(){
            console.log(getCookie("goods"))

            this.goods = JSON.parse(getCookie("goods"));
            console.log(this.goods)
            // console.log(this.res)
            this.display();
        }
        display(){
            var str="";
           for(var i=0;i<this.res.length;i++){
              for(var j=0;j<this.goods.length;j++){
                if(this.res[i].goodsId == this.goods[j].id){
                      str +=`<tr>
                                <td><input type="checkbox" name="" id="" value="" /></td>
                                <td><img src="${this.res[i].src}"/></td>
                                <td>${this.res[i].name}</td>
                                <td>${this.res[i].price}</td>
                                <td><input type="number" value="${this.goods[j].num}"></td>
                                <td><em data-index="${this.res[i].goodsId}">删除</em></td>
                            </tr> `
                }
              }
           }
           this.tbody.innerHTML = str;
        }
        addEvent(){
            var that=this;
            this.tbody.addEventListener("click",function(eve){
                var e=eve||window.event;
                if(eve.target.nodeName == "EM"){
                    that.id = eve.target.getAttribute("data-index");
                    eve.target.parentNode.parentNode.remove();
                    that.removeCookie();
                }
            })
            this.tbody.addEventListener("input",function(eve){
                if(eve.target.type == "number"){
                    that.value=eve.target.value;
                    that.id=eve.target.parentNode.nextElementSibling.children[0].getAttribute("data-index");
                    that.setCookie();
                }

            })

        }
        removeCookie(){
            // this.goods.forEach((v,i)=>{
            //     if(v.id == this.id){
            //         this.goods.splice(i,1);
            //     }
            // })
            for(var i=0;i<this.goods.length;i++){
                if(this.goods[i].id == this.id){
                   break;
                }
            }
            this.goods.splice(i,1)
            setCookie("goods",JSON.stringify(this.goods))
        }
        setCookie(){
            for(var i=0;i<this.goods.length;i++){
                if(this.goods[i].id == this.id){
                   break;
                }
            }
            this.goods[i].num = this.value;
            setCookie("goods",JSON.stringify(this.goods))
        }
   }
    new Car({
        tbody:document.getElementById("tbody"),
        url:"./data/goods.json"
    })

</script>
</html>